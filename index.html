<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#00C6D7">
    <meta name="description" content="Generador de informes profesionales de evaluaci√≥n y planes de bienestar. Funciona offline como app nativa.">
    <title>Generador de Informes</title>

    <!-- Iconos (emoji como fallback) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üè•</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üè•</text></svg>">

    <!-- Manifest PWA inline -->
    <link rel="manifest" href="data:application/manifest+json,{
        %22name%22:%22Generador de Informes Profesionales%22,
        %22short_name%22:%22Informes%22,
        %22start_url%22:%22.%22,
        %22display%22:%22standalone%22,
        %22background_color%22:%22#e0f7fa%22,
        %22theme_color%22:%22#00C6D7%22,
        %22icons%22:[{%22src%22:%22data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè•</text></svg>%22,%22sizes%22:%22192x192%22,%22type%22:%22image/svg+xml%22}]
    }">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #e0f7fa 0%, #f0f4c3 100%);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            padding: 20px env(safe-area-inset-top, 20px) env(safe-area-inset-right, 20px) env(safe-area-inset-bottom, 20px) env(safe-area-inset-left, 20px);
        }
        html { height: -webkit-fill-available; }
        .container { max-width: 900px; margin: 0 auto; }
        .status-bar {
            background: #d4edda; color: #155724; padding: 12px 20px; border-radius: 10px;
            margin-bottom: 20px; font-weight: 600; text-align: center;
        }
        .card {
            background: white; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            padding: 30px; margin-bottom: 20px;
        }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #00C6D7; font-size: 2.5em; margin-bottom: 10px; }
        .header p { color: #666; font-size: 1.1em; }
        .tabs {
            display: flex; gap: 10px; border-bottom: 2px solid #e0e0e0; margin-bottom: 25px;
            overflow-x: auto; padding-bottom: 5px; -webkit-overflow-scrolling: touch;
        }
        .tab {
            padding: 15px 25px; background: none; border: none; font-size: 1em;
            font-weight: 600; color: #666; cursor: pointer; border-bottom: 3px solid transparent;
            transition: all 0.3s; white-space: nowrap; flex-shrink: 0;
        }
        .tab:hover { color: #00C6D7; }
        .tab.active { color: #00C6D7; border-bottom-color: #00C6D7; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .type-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .type-btn {
            padding: 25px; border: 3px solid #e0e0e0; border-radius: 15px; background: white;
            cursor: pointer; text-align: center; transition: all 0.3s;
        }
        .type-btn:hover { border-color: #00C6D7; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,198,215,0.2); }
        .type-btn.active { border-color: #00C6D7; background: #e8f9fa; }
        .type-btn h3 { color: #00C6D7; font-size: 1.3em; margin-bottom: 8px; }
        .type-btn p { color: #666; font-size: 0.95em; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 8px; color: #333; }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%; padding: 12px; border: 2px solid #00C6D7; border-radius: 8px;
            font-size: 1em; font-family: inherit;
        }
        .form-group textarea { min-height: 200px; resize: vertical; line-height: 1.5; }
        .upload-area {
            border: 3px dashed #00C6D7; border-radius: 15px; padding: 50px; text-align: center;
            cursor: pointer; transition: all 0.3s; margin-bottom: 20px;
        }
        .upload-area:hover { background: #f0feff; border-color: #92D700; }
        .upload-area.has-file { background: #e8f9fa; border-style: solid; }
        .upload-icon { font-size: 4em; margin-bottom: 15px; }
        .logo-preview {
            max-width: 180px; max-height: 180px; margin: 15px auto; display: block;
            border: 2px solid #00C6D7; border-radius: 10px; padding: 10px; background: white;
        }
        .btn {
            padding: 15px 30px; border: none; border-radius: 10px; font-size: 1.1em;
            font-weight: bold; cursor: pointer; width: 100%; transition: all 0.3s; margin-top: 10px;
        }
        .btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background: #00C6D7; color: white; }
        .btn-secondary { background: #92D700; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-small {
            padding: 10px 20px; font-size: 0.9em; border: none; border-radius: 8px;
            cursor: pointer; font-weight: 600; transition: all 0.3s;
        }
        .btn-small:hover { transform: translateY(-1px); box-shadow: 0 3px 10px rgba(0,0,0,0.2); }
        .report-item {
            background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 15px;
            display: flex; justify-content: space-between; align-items: center; gap: 15px;
            transition: all 0.3s;
        }
        .report-item:hover { background: #e9ecef; transform: translateX(5px); }
        .report-item-info strong { display: block; color: #00C6D7; font-size: 1.1em; margin-bottom: 5px; }
        .report-item-date { color: #666; font-size: 0.9em; }
        .report-item-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .notification {
            position: fixed; top: env(safe-area-inset-top, 20px); right: 20px;
            background: #00C6D7; color: white; padding: 18px 28px; border-radius: 12px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.3); z-index: 1000; animation: slideIn 0.3s ease;
            font-weight: 600; max-width: 90%;
        }
        @keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .empty-state { text-align: center; padding: 60px 20px; color: #999; }
        .empty-state-icon { font-size: 4em; margin-bottom: 15px; }
        @media (max-width: 768px) {
            body { padding: 10px; }
            .card { padding: 20px; }
            .header h1 { font-size: 1.8em; }
            .type-selector { grid-template-columns: 1fr; }
            .report-item { flex-direction: column; align-items: flex-start; }
            .report-item-actions { width: 100%; justify-content: stretch; }
            .btn-small { flex: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="status-bar">‚óè Aplicaci√≥n lista ¬∑ Funciona sin conexi√≥n</div>
        <div class="card">
            <div class="header">
                <h1>üè• Generador de Informes</h1>
                <p>Crea informes profesionales personalizados</p>
            </div>
            <div class="tabs">
                <button class="tab active" data-tab="generar">üìù Generar</button>
                <button class="tab" data-tab="guardados">üíæ Guardados</button>
                <button class="tab" data-tab="config">‚öôÔ∏è Configuraci√≥n</button>
                <button class="tab" data-tab="ayuda">‚ùì Ayuda</button>
            </div>

            <!-- TAB: GENERAR -->
            <div class="tab-content active" id="content-generar">
                <div class="type-selector">
                    <div class="type-btn active" data-type="evaluacion"><h3>üìä Evaluaci√≥n</h3><p>Informe de evaluaci√≥n funcional completo</p></div>
                    <div class="type-btn" data-type="plan"><h3>üìã Plan</h3><p>Plan de bienestar y movimiento activo</p></div>
                </div>
                <div class="form-group">
                    <label>M√©todo de entrada:</label>
                    <select id="inputMethod">
                        <option value="file">üì∏ Subir archivo o usar c√°mara</option>
                        <option value="manual">‚úçÔ∏è Escribir manualmente</option>
                    </select>
                </div>
                <div id="uploadArea" class="upload-area">
                    <input type="file" id="fileInput" accept="image/*,.pdf,.doc,.docx,.txt" capture="environment" style="display:none;">
                    <div id="uploadContent">
                        <div class="upload-icon">üì§</div>
                        <p style="font-size:1.1em;font-weight:600;margin-bottom:8px;">Arrastra archivos aqu√≠ o toca para seleccionar</p>
                        <p style="color:#666;">Im√°genes, PDF, Word, Texto ¬∑ Usa la c√°mara en m√≥viles</p>
                    </div>
                </div>
                <div id="manualArea" style="display:none;">
                    <div class="form-group">
                        <textarea id="manualInput" placeholder="Escribe o pega la informaci√≥n del informe aqu√≠...

Ejemplo para Evaluaci√≥n:
‚Ä¢ Nombre del participante
‚Ä¢ Edad
‚Ä¢ Condiciones m√©dicas
‚Ä¢ Resultados de pruebas
‚Ä¢ Observaciones

Ejemplo para Plan:
‚Ä¢ Frecuencia de sesiones
‚Ä¢ Duraci√≥n
‚Ä¢ Actividades planificadas
‚Ä¢ Objetivos del programa"></textarea>
                    </div>
                </div>
                <button class="btn btn-primary" id="generateBtn">‚ú® Generar Informe</button>
            </div>

            <!-- TAB: GUARDADOS -->
            <div class="tab-content" id="content-guardados">
                <h2 style="color:#00C6D7;margin-bottom:25px;">üìÇ Informes Guardados</h2>
                <div id="savedReportsList"></div>
            </div>

            <!-- TAB: CONFIGURACI√ìN -->
            <div class="tab-content" id="content-config">
                <h2 style="color:#00C6D7;margin-bottom:25px;">‚öôÔ∏è Configuraci√≥n de Empresa</h2>
                <div class="form-group">
                    <label>Nombre de la Empresa u Organizaci√≥n</label>
                    <input type="text" id="companyName" placeholder="Ej: Centro de Rehabilitaci√≥n Wellness">
                </div>
                <div class="form-group">
                    <label>Logo de la Empresa</label>
                    <input type="file" id="logoInput" accept="image/*" capture="environment" style="display:none;">
                    <div style="text-align:center;">
                        <img id="logoPreview" class="logo-preview" style="display:none;">
                        <button class="btn btn-secondary" id="uploadLogoBtn">üì∑ Seleccionar Logo</button>
                        <p style="color:#666;font-size:0.9em;margin-top:10px;">El logo aparecer√° en todos tus informes</p>
                    </div>
                </div>
                <button class="btn btn-success" id="saveConfigBtn">üíæ Guardar Configuraci√≥n</button>
            </div>

            <!-- TAB: AYUDA -->
            <div class="tab-content" id="content-ayuda">
                <h2 style="color:#00C6D7;margin-bottom:25px;">üìñ Gu√≠a de Uso</h2>
                <h3 style="color:#92D700;margin:20px 0 10px;">üöÄ Primeros Pasos</h3>
                <ol style="margin-left:25px;line-height:2;">
                    <li><strong>Configura tu empresa:</strong> Ve a "Configuraci√≥n" y guarda logo y nombre</li>
                    <li><strong>Selecciona el tipo:</strong> Evaluaci√≥n o Plan</li>
                    <li><strong>Ingresa datos:</strong> Usa la c√°mara, sube archivo o escribe</li>
                    <li><strong>Genera:</strong> Pulsa "Generar Informe"</li>
                    <li><strong>Revisa:</strong> Ve a "Guardados" para ver, imprimir o borrar</li>
                </ol>
                <h3 style="color:#92D700;margin:25px 0 10px;">üì± En m√≥viles</h3>
                <ul style="margin-left:25px;line-height:2;">
                    <li>Guarda esta p√°gina en la pantalla de inicio para usarla como app</li>
                    <li>iOS: Safari ‚Üí Compartir ‚Üí A√±adir a pantalla de inicio</li>
                    <li>Android: Chrome ‚Üí Men√∫ ‚Üí A√±adir a pantalla de inicio</li>
                    <li>Funciona sin internet despu√©s de la primera carga</li>
                </ul>
                <h3 style="color:#92D700;margin:25px 0 10px;">üì• Exportar como PDF</h3>
                <p style="margin-left:25px;line-height:1.8;">Pulsa "Ver" ‚Üí abre en nueva ventana ‚Üí Cmd/Ctrl + P ‚Üí "Guardar como PDF"</p>
            </div>
        </div>
    </div>

    <script>
        // Service Worker PWA (cach√© b√°sico para offline)
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE_NAME = 'informes-app-v1';
                self.addEventListener('install', e => {
                    e.waitUntil(caches.open(CACHE_NAME).then(cache => cache.addAll(['./'])));
                    self.skipWaiting();
                });
                self.addEventListener('fetch', e => {
                    e.respondWith(caches.match(e.request).then(resp => resp || fetch(e.request)));
                });
                self.addEventListener('activate', e => e.waitUntil(self.clients.claim()));
            `;
            const blob = new Blob([swCode], {type: 'application/javascript'});
            const swUrl = URL.createObjectURL(blob);
            navigator.serviceWorker.register(swUrl);
        }

        var APP = {
            state: { reportType: 'evaluacion', currentFile: null, companyName: '', companyLogo: '' },
            init: function() { this.loadConfig(); this.setupEventListeners(); this.changeInputMethod(); },
            loadConfig: function() {
                try {
                    const name = localStorage.getItem('company_name');
                    const logo = localStorage.getItem('company_logo');
                    if (name) { this.state.companyName = name; document.getElementById('companyName').value = name; }
                    if (logo) {
                        this.state.companyLogo = logo;
                        const preview = document.getElementById('logoPreview');
                        preview.src = logo; preview.style.display = 'block';
                    }
                } catch(e) { console.error(e); }
            },
            setupEventListeners: function() {
                const self = this;
                document.querySelectorAll('.tab').forEach(tab => tab.addEventListener('click', () => self.switchTab(tab.dataset.tab)));
                document.querySelectorAll('.type-btn').forEach(btn => btn.addEventListener('click', () => self.selectType(btn.dataset.type)));
                document.getElementById('inputMethod').addEventListener('change', () => self.changeInputMethod());
                const uploadArea = document.getElementById('uploadArea');
                uploadArea.addEventListener('click', e => { if (!e.target.closest('input')) document.getElementById('fileInput').click(); });
                uploadArea.addEventListener('dragover', e => { e.preventDefault(); uploadArea.style.background = '#f0feff'; });
                uploadArea.addEventListener('dragleave', () => { if (!uploadArea.classList.contains('has-file')) uploadArea.style.background = ''; });
                uploadArea.addEventListener('drop', e => { e.preventDefault(); uploadArea.style.background = ''; if (e.dataTransfer.files.length) self.handleFileSelect({files: e.dataTransfer.files}); });
                document.getElementById('fileInput').addEventListener('change', () => self.handleFileSelect(document.getElementById('fileInput')));
                document.getElementById('generateBtn').addEventListener('click', () => self.generateReport());
                document.getElementById('uploadLogoBtn').addEventListener('click', () => document.getElementById('logoInput').click());
                document.getElementById('logoInput').addEventListener('change', () => self.handleLogoSelect(document.getElementById('logoInput')));
                document.getElementById('saveConfigBtn').addEventListener('click', () => self.saveConfig());
            },
            switchTab: function(tabName) {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                const tab = document.querySelector(`[data-tab="${tabName}"]`);
                const content = document.getElementById(`content-${tabName}`);
                if (tab) tab.classList.add('active');
                if (content) content.classList.add('active');
                if (tabName === 'guardados') this.loadSavedReports();
            },
            selectType: function(type) {
                document.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('active'));
                const selected = document.querySelector(`[data-type="${type}"]`);
                if (selected) selected.classList.add('active');
                this.state.reportType = type;
            },
            changeInputMethod: function() {
                const method = document.getElementById('inputMethod').value;
                document.getElementById('uploadArea').style.display = method === 'file' ? 'block' : 'none';
                document.getElementById('manualArea').style.display = method === 'manual' ? 'block' : 'none';
            },
            handleFileSelect: function(input) {
                const file = input.files[0];
                if (file) {
                    this.state.currentFile = file;
                    const content = document.getElementById('uploadContent');
                    const uploadArea = document.getElementById('uploadArea');
                    content.innerHTML = `<div class="upload-icon">üìÑ</div><p style="font-size:1.2em;font-weight:600;color:#00C6D7;margin-bottom:8px;">${file.name}</p><p style="color:#666;">${(file.size/1024).toFixed(2)} KB</p>`;
                    uploadArea.classList.add('has-file');
                }
            },
            generateReport: function() {
                const method = document.getElementById('inputMethod').value;
                if (method === 'file' && !this.state.currentFile) return this.showNotification('‚ö†Ô∏è Selecciona un archivo', '#e74c3c');
                if (method === 'manual' && !document.getElementById('manualInput').value.trim()) return this.showNotification('‚ö†Ô∏è Escribe algo en el texto', '#e74c3c');
                this.showNotification('‚è≥ Generando informe...', '#00C6D7');
                const self = this;
                setTimeout(() => {
                    const html = self.createReportHTML();
                    self.saveReport(html);
                    self.showNotification('‚úÖ Informe generado y guardado', '#92D700');
                    setTimeout(() => self.switchTab('guardados'), 1000);
                }, 800);
            },
            createReportHTML: function() {
                const method = document.getElementById('inputMethod').value;
                const contentText = method === 'manual' ? document.getElementById('manualInput').value : 'Informaci√≥n del archivo: ' + (this.state.currentFile ? this.state.currentFile.name : '');
                const title = this.state.reportType === 'evaluacion' ? 'Informe de Evaluaci√≥n Funcional' : 'Plan de Bienestar y Movimiento Activo';
                let html = `<!DOCTYPE html><html lang="es"><head><meta charset="UTF-8"><title>${title}</title><style>
                    @media print { @page { size: letter; margin: 0.6in 0.7in; } * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; } }
                    body { font-family: Calibri, Arial, sans-serif; max-width: 8.5in; margin: 0 auto; padding: 0.6in 0.7in; color: #1a1a1a; line-height: 1.6; }
                    .header { text-align: center; border-bottom: 3px solid #00C6D7; padding-bottom: 15px; margin-bottom: 25px; }
                    h1 { color: #00C6D7; font-size: 22pt; font-weight: bold; margin: 10px 0; }
                    h2 { color: #00C6D7; font-size: 14pt; border-bottom: 2px solid #92D700; padding-bottom: 6px; margin-top: 25px; margin-bottom: 15px; }
                    .company-name { color: #92D700; font-size: 14pt; font-weight: 600; margin-bottom: 10px; }
                    .content { white-space: pre-wrap; line-height: 1.8; }
                    p { margin: 12px 0; }
                </style></head><body><div class="header">`;
                if (this.state.companyLogo) html += `<img src="${this.state.companyLogo}" alt="Logo" style="max-width:200px;max-height:100px;margin:0 auto 15px;display:block;">`;
                if (this.state.companyName) html += `<div class="company-name">${this.state.companyName}</div>`;
                html += `<h1>${title}</h1></div><h2>Informaci√≥n del Participante</h2><div class="content">${this.escapeHtml(contentText)}</div>
                <h2>Fecha de Generaci√≥n</h2><p>${new Date().toLocaleString('es-ES',{weekday:'long',year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit'})}</p></body></html>`;
                return html;
            },
            escapeHtml: function(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            },
            saveReport: function(html) {
                const timestamp = Date.now();
                const key = 'report_' + timestamp;
                const report = { html, type: this.state.reportType, date: new Date().toLocaleString('es-ES'), timestamp };
                try { localStorage.setItem(key, JSON.stringify(report)); } catch(e) { this.showNotification('‚ùå Error al guardar', '#e74c3c'); }
            },
            loadSavedReports: function() {
                const container = document.getElementById('savedReportsList');
                const keys = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('report_')) keys.push(key);
                }
                if (keys.length === 0) {
                    container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üì≠</div><p style="font-size:1.2em;">No hay informes guardados</p><p style="color:#999;margin-top:10px;">Genera tu primer informe</p></div>`;
                    return;
                }
                keys.sort().reverse();
                container.innerHTML = '';
                keys.forEach(key => {
                    try {
                        const report = JSON.parse(localStorage.getItem(key));
                        this.addReportItem(container, key, report);
                    } catch(e) {}
                });
            },
            addReportItem: function(container, key, report) {
                const div = document.createElement('div'); div.className = 'report-item';
                const typeIcon = report.type === 'evaluacion' ? 'üìä' : 'üìã';
                const typeName = report.type === 'evaluacion' ? 'Informe de Evaluaci√≥n' : 'Plan de Bienestar';
                div.innerHTML = `
                    <div class="report-item-info">
                        <strong>${typeIcon} ${typeName}</strong>
                        <div class="report-item-date">üìÖ ${report.date}</div>
                    </div>
                    <div class="report-item-actions">
                        <button class="btn-small" style="background:#00C6D7;color:white;">üëÅÔ∏è Ver</button>
                        <button class="btn-small" style="background:#92D700;color:white;">üì• Descargar</button>
                        <button class="btn-small" style="background:#dc3545;color:white;">üóëÔ∏è Borrar</button>
                    </div>`;
                div.querySelectorAll('button')[0].onclick = () => this.viewReport(key);
                div.querySelectorAll('button')[1].onclick = () => this.downloadReport(key);
                div.querySelectorAll('button')[2].onclick = () => this.deleteReport(key);
                container.appendChild(div);
            },
            viewReport: function(key) {
                try {
                    const report = JSON.parse(localStorage.getItem(key));
                    const win = window.open('', '_blank');
                    if (win) { win.document.write(report.html); win.document.close(); }
                    else this.showNotification('‚ö†Ô∏è Permite ventanas emergentes', '#e74c3c');
                } catch(e) { this.showNotification('‚ùå Error al abrir', '#e74c3c'); }
            },
            downloadReport: function(key) {
                try {
                    const report = JSON.parse(localStorage.getItem(key));
                    const win = window.open('', '_blank');
                    if (win) {
                        win.document.write(report.html); win.document.close();
                        setTimeout(() => win.print(), 500);
                        this.showNotification('üíæ Usa "Guardar como PDF" al imprimir', '#00C6D7');
                    } else this.showNotification('‚ö†Ô∏è Permite ventanas emergentes', '#e74c3c');
                } catch(e) { this.showNotification('‚ùå Error', '#e74c3c'); }
            },
            deleteReport: function(key) {
                if (confirm('¬øEliminar este informe? No se puede deshacer.')) {
                    localStorage.removeItem(key);
                    this.loadSavedReports();
                    this.showNotification('‚úÖ Informe eliminado', '#92D700');
                }
            },
            handleLogoSelect: function(input) {
                const file = input.files[0];
                if (file) {
                    if (file.size > 5000000) return this.showNotification('‚ö†Ô∏è Imagen muy grande (<5MB)', '#e74c3c');
                    const reader = new FileReader();
                    reader.onload = e => {
                        this.state.companyLogo = e.target.result;
                        const preview = document.getElementById('logoPreview');
                        preview.src = this.state.companyLogo;
                        preview.style.display = 'block';
                        this.showNotification('‚úÖ Logo cargado. Guarda la configuraci√≥n', '#00C6D7');
                    };
                    reader.readAsDataURL(file);
                }
            },
            saveConfig: function() {
                this.state.companyName = document.getElementById('companyName').value.trim();
                localStorage.setItem('company_name', this.state.companyName);
                localStorage.setItem('company_logo', this.state.companyLogo);
                this.showNotification('‚úÖ Configuraci√≥n guardada', '#92D700');
            },
            showNotification: function(message, color = '#00C6D7') {
                const existing = document.querySelector('.notification');
                if (existing) existing.remove();
                const notif = document.createElement('div');
                notif.className = 'notification';
                notif.style.background = color;
                notif.textContent = message;
                document.body.appendChild(notif);
                setTimeout(() => notif.remove(), 4000);
            }
        };

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => APP.init());
        } else {
            APP.init();
        }
    </script>
</body>
</html>
